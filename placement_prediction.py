# -*- coding: utf-8 -*-
"""Untitled18.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1MuFC9_yZINGBR33nddiQ0nPMg_iql2I2
"""

# placement_prediction_logistic_regression.py
# Logistic Regression model for Placement Prediction using placementdata.csv

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler, LabelEncoder, OneHotEncoder
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import Pipeline
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score, confusion_matrix, classification_report, roc_auc_score
import joblib

# -------------------------------
# 1. Load the dataset
# -------------------------------
df = pd.read_csv("placementdata.csv")
print("Dataset loaded successfully! Shape:", df.shape)

# Preview
print(df.head())

# -------------------------------
# 2. Data Cleaning
# -------------------------------
# Drop StudentID since it's not a useful feature
df = df.drop(columns=["StudentID"])

# Rename target column for simplicity
df.rename(columns={"PlacementStatus": "Placed"}, inplace=True)

# Convert target to binary (1 = Placed, 0 = NotPlaced)
df["Placed"] = df["Placed"].map({"Placed": 1, "NotPlaced": 0})

# Identify categorical and numeric columns
cat_cols = ["ExtracurricularActivities", "PlacementTraining"]
num_cols = [c for c in df.columns if c not in cat_cols + ["Placed"]]

print("\nCategorical columns:", cat_cols)
print("Numeric columns:", num_cols)

# -------------------------------
# 3. Exploratory Data Analysis (optional for interview demo)
# -------------------------------
plt.figure(figsize=(5,3))
sns.countplot(x="Placed", data=df)
plt.title("Placement Distribution")
plt.show()

sns.heatmap(df[num_cols + ['Placed']].corr(), annot=True, cmap="coolwarm")
plt.title("Correlation Heatmap")
plt.show()

# -------------------------------
# 4. Split Data
# -------------------------------
X = df.drop(columns=["Placed"])
y = df["Placed"]

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42, stratify=y)
print(f"Train size: {X_train.shape}, Test size: {X_test.shape}")

# -------------------------------
# 5. Preprocessing Pipeline
# -------------------------------
numeric_transformer = Pipeline(steps=[
    ("scaler", StandardScaler())
])

categorical_transformer = Pipeline(steps=[
    ("encoder", OneHotEncoder(drop='first', handle_unknown='ignore'))
])

preprocessor = ColumnTransformer(
    transformers=[
        ("num", numeric_transformer, num_cols),
        ("cat", categorical_transformer, cat_cols)
    ]
)

# -------------------------------
# 6. Logistic Regression Model
# -------------------------------
model = Pipeline(steps=[
    ("preprocessor", preprocessor),
    ("classifier", LogisticRegression(max_iter=1000))
])

model.fit(X_train, y_train)
print("\nModel trained successfully!")

# -------------------------------
# 7. Evaluation
# -------------------------------
y_pred = model.predict(X_test)
y_prob = model.predict_proba(X_test)[:, 1]

print("\nAccuracy:", accuracy_score(y_test, y_pred))
print("ROC AUC Score:", roc_auc_score(y_test, y_prob))
print("\nClassification Report:\n", classification_report(y_test, y_pred))

# Confusion Matrix
cm = confusion_matrix(y_test, y_pred)
sns.heatmap(cm, annot=True, fmt="d", cmap="Blues", xticklabels=["Not Placed", "Placed"], yticklabels=["Not Placed", "Placed"])
plt.xlabel("Predicted")
plt.ylabel("Actual")
plt.title("Confusion Matrix")
plt.show()

# -------------------------------
# 8. Save the model
# -------------------------------
joblib.dump(model, "placement_model.joblib")
print("\nModel saved as placement_model.joblib")

# -------------------------------
# 9. Test with new student data
# -------------------------------
sample = pd.DataFrame({
    "CGPA": [8.5],
    "Internships": [1],
    "Projects": [2],
    "Workshops/Certifications": [2],
    "AptitudeTestScore": [88],
    "SoftSkillsRating": [4.5],
    "ExtracurricularActivities": ["Yes"],
    "PlacementTraining": ["Yes"],
    "SSC_Marks": [78],
    "HSC_Marks": [82]
})

loaded_model = joblib.load("placement_model.joblib")
pred = loaded_model.predict(sample)
prob = loaded_model.predict_proba(sample)[:,1]

print("\nNew student placement prediction:")
print("Placed (1 = Yes, 0 = No):", int(pred[0]))
print("Probability of getting placed:", round(prob[0]*100, 2), "%")

import pandas as pd
import joblib

# Load your saved trained model
model = joblib.load("placement_model.joblib")

# Load the new student data
students = pd.read_csv("/content/students.csv")

# Drop Name column for prediction
X_new = students.drop("Name", axis=1)

# Predict placement and probability
pred = model.predict(X_new)
prob = model.predict_proba(X_new)[:, 1]

# Add predictions to the dataframe
students["Predicted_Placement"] = pred
students["Placement_Probability (%)"] = (prob * 100).round(2)

# Show results
display(students)

# Save the results to a new CSV
students.to_csv("students_predictions.csv", index=False)
print("‚úÖ Predictions saved as students_predictions.csv")

# ---------------------------------------------------------------
# placement_prediction_logistic_regression.py
# Logistic Regression Model for Placement Prediction
# ---------------------------------------------------------------

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler, OneHotEncoder
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import Pipeline
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score, confusion_matrix, classification_report, roc_auc_score
import joblib

# ---------------------------------------------------------------
# 1. Load Dataset
# ---------------------------------------------------------------
df = pd.read_csv("placementdata.csv")
print("‚úÖ Dataset loaded successfully! Shape:", df.shape)
print(df.head())

# ---------------------------------------------------------------
# 2. Data Cleaning & Preparation
# ---------------------------------------------------------------
# Drop StudentID if exists
if "StudentID" in df.columns:
    df = df.drop(columns=["StudentID"])

# Rename target column for simplicity
if "PlacementStatus" in df.columns:
    df.rename(columns={"PlacementStatus": "Placed"}, inplace=True)

# Convert target column to binary (1 = Placed, 0 = NotPlaced)
df["Placed"] = df["Placed"].map({"Placed": 1, "NotPlaced": 0})

# Identify categorical and numeric columns
cat_cols = ["ExtracurricularActivities", "PlacementTraining"]
num_cols = [c for c in df.columns if c not in cat_cols + ["Placed"]]

print("\nCategorical columns:", cat_cols)
print("Numeric columns:", num_cols)

# ---------------------------------------------------------------
# 3. Basic Visualization (Optional)
# ---------------------------------------------------------------
plt.figure(figsize=(5, 3))
sns.countplot(x="Placed", data=df)
plt.title("Placement Distribution")
plt.show()

sns.heatmap(df[num_cols + ['Placed']].corr(), annot=True, cmap="coolwarm")
plt.title("Correlation Heatmap")
plt.show()

# ---------------------------------------------------------------
# 4. Split Data
# ---------------------------------------------------------------
X = df.drop(columns=["Placed"])
y = df["Placed"]

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)
print(f"\nüìä Train size: {X_train.shape}, Test size: {X_test.shape}")

# ---------------------------------------------------------------
# 5. Preprocessing & Model Pipeline
# ---------------------------------------------------------------
numeric_transformer = Pipeline(steps=[
    ("scaler", StandardScaler())
])

categorical_transformer = Pipeline(steps=[
    ("encoder", OneHotEncoder(drop='first', handle_unknown='ignore'))
])

preprocessor = ColumnTransformer(
    transformers=[
        ("num", numeric_transformer, num_cols),
        ("cat", categorical_transformer, cat_cols)
    ]
)

model = Pipeline(steps=[
    ("preprocessor", preprocessor),
    ("classifier", LogisticRegression(max_iter=1000))
])

# ---------------------------------------------------------------
# 6. Train the Model
# ---------------------------------------------------------------
model.fit(X_train, y_train)
print("\n‚úÖ Model trained successfully!")

# ---------------------------------------------------------------
# 7. Evaluation
# ---------------------------------------------------------------
y_pred = model.predict(X_test)
y_prob = model.predict_proba(X_test)[:, 1]

print("\nüìà Accuracy:", accuracy_score(y_test, y_pred))
print("ROC AUC Score:", roc_auc_score(y_test, y_prob))
print("\nClassification Report:\n", classification_report(y_test, y_pred))

# Confusion Matrix
cm = confusion_matrix(y_test, y_pred)
sns.heatmap(cm, annot=True, fmt="d", cmap="Blues",
            xticklabels=["Not Placed", "Placed"],
            yticklabels=["Not Placed", "Placed"])
plt.xlabel("Predicted")
plt.ylabel("Actual")
plt.title("Confusion Matrix")
plt.show()

# ---------------------------------------------------------------
# 8. Save Model
# ---------------------------------------------------------------
joblib.dump(model, "placement_model.joblib")
print("\nüíæ Model saved as placement_model.joblib")

# ---------------------------------------------------------------
# 9. Predict New Data from CSV (students.csv)
# ---------------------------------------------------------------
try:
    students = pd.read_csv("students.csv")
    print("\nüìò New data loaded from students.csv")

    if "Name" in students.columns:
        X_new = students.drop("Name", axis=1)
    else:
        X_new = students

    loaded_model = joblib.load("placement_model.joblib")
    pred = loaded_model.predict(X_new)
    prob = loaded_model.predict_proba(X_new)[:, 1]

    students["Predicted_Placement"] = pred
    students["Placement_Probability (%)"] = (prob * 100).round(2)

    print("\nüßæ Predictions for new students:")
    print(students.head())

    students.to_csv("students_predictions.csv", index=False)
    print("‚úÖ Predictions saved as students_predictions.csv")

except FileNotFoundError:
    print("\n‚ö†Ô∏è No students.csv file found ‚Äî skipping CSV prediction step.")

# ---------------------------------------------------------------
# 10. Interactive Input (for Interview Demo)
# ---------------------------------------------------------------
print("\nüéØ Interactive Placement Prediction Demo")
print("Enter details for a new student:\n")

cgpa = float(input("Enter CGPA: "))
internships = int(input("Enter number of Internships: "))
projects = int(input("Enter number of Projects: "))
workshops = int(input("Enter number of Workshops/Certifications: "))
aptitude = float(input("Enter Aptitude Test Score: "))
softskills = float(input("Enter Soft Skills Rating (1‚Äì5): "))
extra = input("Participated in Extracurricular Activities? (Yes/No): ").capitalize()
training = input("Attended Placement Training? (Yes/No): ").capitalize()
ssc = float(input("Enter SSC/10th Marks (%): "))
hsc = float(input("Enter HSC/12th Marks (%): "))

# Create DataFrame for new input
new_student = pd.DataFrame({
    "CGPA": [cgpa],
    "Internships": [internships],
    "Projects": [projects],
    "Workshops/Certifications": [workshops],
    "AptitudeTestScore": [aptitude],
    "SoftSkillsRating": [softskills],
    "ExtracurricularActivities": [extra],
    "PlacementTraining": [training],
    "SSC_Marks": [ssc],
    "HSC_Marks": [hsc]
})

# Load trained model and predict
loaded_model = joblib.load("placement_model.joblib")
pred = loaded_model.predict(new_student)
prob = loaded_model.predict_proba(new_student)[:, 1][0]

print("\n--- üß† Prediction Result ---")
if pred[0] == 1:
    print("üéâ Student is LIKELY TO BE PLACED!")
else:
    print("‚ùå Student is NOT LIKELY TO BE PLACED.")

print(f"üìä Probability of Placement: {prob * 100:.2f}%")